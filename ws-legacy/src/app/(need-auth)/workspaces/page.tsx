import Link from "next/link";
import Image from "next/image";
import { getWorkspaces } from "@/domains/workspace/actions/getWorkspaces";

export default async function WorkspaceListPage() {
  const { workspaces } = await getWorkspaces();

  return (
    <div className="flex items-center justify-center">
      <div className="flex w-[min(1200px,100%)] flex-col gap-[48px] bg-white-normal p-[16px]">
        <div className="sticky top-0 z-[10] flex items-center bg-white-normal p-[16px]">
          <Link href="/">
            <svg
              width="151"
              height="34"
              viewBox="0 0 151 34"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M15.8197 17.8477H14.2742C14.0189 17.8477 13.812 18.0546 13.812 18.3099V20.8122C13.812 21.0675 14.0189 21.2745 14.2742 21.2745H15.8197C16.075 21.2745 16.282 21.0675 16.282 20.8122V18.3099C16.282 18.0546 16.075 17.8477 15.8197 17.8477Z"
                fill="#416BFF"
              />
              <path
                d="M21.3485 17.8477H19.8031C19.5478 17.8477 19.3408 18.0546 19.3408 18.3099V20.8122C19.3408 21.0675 19.5478 21.2745 19.8031 21.2745H21.3485C21.6039 21.2745 21.8108 21.0675 21.8108 20.8122V18.3099C21.8108 18.0546 21.6039 17.8477 21.3485 17.8477Z"
                fill="#416BFF"
              />
              <path
                d="M31.274 18.1489H30.2231C29.8334 16.2486 28.8577 14.3726 27.3096 12.8272C27.3096 12.8272 23.9984 9.03213 18.8165 8.58597C18.803 8.58597 18.7896 8.58597 18.7761 8.58328C18.631 8.57253 18.4859 8.56178 18.338 8.55372C18.1687 8.54566 17.9994 8.54297 17.8301 8.54297C17.6607 8.54297 17.4887 8.54834 17.3221 8.55372C17.1743 8.5591 17.0291 8.56985 16.884 8.58328C16.8706 8.58328 16.8544 8.58328 16.841 8.58597C11.6591 9.03213 8.35319 12.8272 8.35319 12.8272C6.80776 14.3726 5.82943 16.2486 5.43971 18.1489H4.38075C3.74376 18.1489 3.22504 18.6649 3.22504 19.3046V22.1428C3.22504 22.7798 3.74108 23.2985 4.38075 23.2985H5.29457C5.65204 26.3222 8.22149 28.6686 11.3419 28.6686H17.9644L25.8045 32.9071C27.2371 33.8209 29.1158 32.7915 29.1158 31.0929V26.341C29.7904 25.4836 30.2392 24.4408 30.3736 23.3012H31.2767C31.9137 23.3012 32.4324 22.7852 32.4324 22.1455V19.3073C32.4324 18.6703 31.9164 18.1515 31.2767 18.1515L31.274 18.1489ZM26.1835 22.8792C26.1835 23.8791 25.3745 24.6881 24.3746 24.6881H24.2429V27.1419C24.2429 27.3731 23.9876 27.5128 23.7941 27.3865L19.6335 24.6881H11.2801C10.2803 24.6881 9.47128 23.8791 9.47128 22.8792V16.9233C9.47128 15.9234 10.2803 15.1144 11.2801 15.1144H24.3746C25.3745 15.1144 26.1835 15.9234 26.1835 16.9233V22.8792Z"
                fill="#416BFF"
              />
              <path
                d="M14.1861 7.95094C15.0005 7.68754 15.8874 7.49403 16.8389 7.41071C16.8523 7.41071 16.8684 7.41071 16.8819 7.40802C17.027 7.39727 17.1721 7.38652 17.32 7.37846C17.4893 7.37039 17.6586 7.36771 17.8279 7.36771C17.9973 7.36771 18.1693 7.37308 18.3359 7.37846C18.4837 7.38383 18.6289 7.39458 18.774 7.40802C18.7875 7.40802 18.8009 7.40802 18.8143 7.41071C19.7631 7.49134 20.65 7.68754 21.4671 7.95094C21.2575 6.34638 20.0157 5.06703 18.4273 4.80632V3.20375C19.0455 2.96186 19.4863 2.3625 19.4863 1.65832C19.4863 0.741808 18.7445 0 17.8279 0C16.9114 0 16.1696 0.741808 16.1696 1.65832C16.1696 2.3625 16.6077 2.96186 17.2286 3.20375V4.80632C15.6401 5.06703 14.3957 6.34638 14.1888 7.95094H14.1861Z"
                fill="#416BFF"
              />
              <path
                d="M41.668 26.7585V6.96167H48.7227C50.7005 6.96167 52.4095 7.35815 53.8496 8.15112C55.2897 8.93498 56.3926 10.0697 57.1582 11.5554C57.9329 13.0411 58.3203 14.8002 58.3203 16.8328C58.3203 18.8835 57.9329 20.6563 57.1582 22.1511C56.3835 23.6368 55.2715 24.7761 53.8223 25.5691C52.373 26.3621 50.6458 26.7585 48.6406 26.7585H41.668ZM48.4766 23.2312C50.3906 23.2312 51.8262 22.7117 52.7832 21.6726C53.7402 20.6335 54.2188 19.0203 54.2188 16.8328C54.2188 14.6635 53.7402 13.0639 52.7832 12.0339C51.8353 11.004 50.4089 10.489 48.5039 10.489H45.7695V23.2312H48.4766ZM67.8906 27.0593C66.4141 27.0593 65.1289 26.7403 64.0352 26.1023C62.9414 25.4643 62.0983 24.5665 61.5059 23.4089C60.9134 22.2423 60.6172 20.8979 60.6172 19.3757C60.6172 17.8536 60.9089 16.5138 61.4922 15.3562C62.0846 14.1986 62.9277 13.3054 64.0215 12.6765C65.1243 12.0385 66.4141 11.7195 67.8906 11.7195C69.3672 11.7195 70.6569 12.0385 71.7598 12.6765C72.8626 13.3054 73.7103 14.1986 74.3027 15.3562C74.8952 16.5138 75.1914 17.8536 75.1914 19.3757C75.1914 20.8979 74.8952 22.2423 74.3027 23.4089C73.7103 24.5665 72.8626 25.4643 71.7598 26.1023C70.6569 26.7403 69.3672 27.0593 67.8906 27.0593ZM67.918 23.9148C68.5924 23.9148 69.1667 23.7234 69.6406 23.3406C70.1146 22.9486 70.4701 22.4109 70.707 21.7273C70.944 21.0437 71.0625 20.2598 71.0625 19.3757C71.0625 18.4916 70.944 17.7078 70.707 17.0242C70.4701 16.3315 70.1146 15.7891 69.6406 15.3972C69.1667 15.0053 68.5924 14.8093 67.918 14.8093C67.2344 14.8093 66.651 15.0053 66.168 15.3972C65.694 15.7891 65.334 16.3315 65.0879 17.0242C64.8418 17.7078 64.7188 18.4916 64.7188 19.3757C64.7188 20.2507 64.8418 21.0346 65.0879 21.7273C65.334 22.4109 65.694 22.9486 66.168 23.3406C66.651 23.7234 67.2344 23.9148 67.918 23.9148ZM84.4062 27.0593C82.9206 27.0593 81.6263 26.7358 80.5234 26.0886C79.4297 25.4415 78.5911 24.5391 78.0078 23.3816C77.4245 22.224 77.1328 20.8888 77.1328 19.3757C77.1328 17.8627 77.4245 16.532 78.0078 15.3835C78.6003 14.226 79.4434 13.3282 80.5371 12.6902C81.64 12.0431 82.9297 11.7195 84.4062 11.7195C85.6732 11.7195 86.7943 11.9519 87.7695 12.4167C88.7448 12.8816 89.5104 13.5424 90.0664 14.3992C90.6315 15.2468 90.9414 16.2312 90.9961 17.3523H87.1953C87.0677 16.5958 86.7669 15.9942 86.293 15.5476C85.819 15.0919 85.2083 14.864 84.4609 14.864C83.8138 14.864 83.2441 15.0417 82.752 15.3972C82.2689 15.7436 81.8952 16.254 81.6309 16.9285C81.3665 17.6029 81.2344 18.4005 81.2344 19.321C81.2344 20.269 81.3665 21.0802 81.6309 21.7546C81.8952 22.4291 82.2689 22.9441 82.752 23.2996C83.235 23.655 83.8047 23.8328 84.4609 23.8328C85.181 23.8328 85.7871 23.6186 86.2793 23.1902C86.7715 22.7618 87.0768 22.1557 87.1953 21.3718H90.9961C90.9323 22.4929 90.627 23.4819 90.0801 24.3386C89.5332 25.1954 88.7721 25.8653 87.7969 26.3484C86.8307 26.8223 85.7005 27.0593 84.4062 27.0593ZM100.238 27.0593C98.7344 27.0593 97.431 26.7494 96.3281 26.1296C95.2344 25.5098 94.3913 24.6257 93.7988 23.4773C93.2064 22.3197 92.9102 20.9617 92.9102 19.4031C92.9102 17.8809 93.2018 16.5411 93.7852 15.3835C94.3776 14.2169 95.2161 13.3145 96.3008 12.6765C97.3854 12.0385 98.6432 11.7195 100.074 11.7195C101.405 11.7195 102.594 12.002 103.643 12.5671C104.7 13.1231 105.529 13.9662 106.131 15.0964C106.742 16.2266 107.047 17.6075 107.047 19.239V20.3875H96.9023C96.9023 21.1257 97.0391 21.7683 97.3125 22.3152C97.5951 22.8621 97.9915 23.2859 98.502 23.5867C99.0215 23.8783 99.6276 24.0242 100.32 24.0242C100.986 24.0242 101.56 23.892 102.043 23.6277C102.526 23.3542 102.872 22.9851 103.082 22.5203H106.938C106.746 23.4317 106.354 24.2292 105.762 24.9128C105.169 25.5964 104.399 26.1251 103.451 26.4988C102.512 26.8725 101.441 27.0593 100.238 27.0593ZM103.219 17.8445C103.219 17.252 103.087 16.7234 102.822 16.2585C102.567 15.7846 102.207 15.4154 101.742 15.1511C101.277 14.8868 100.749 14.7546 100.156 14.7546C99.5547 14.7546 99.0078 14.8914 98.5156 15.1648C98.0326 15.4382 97.6452 15.8119 97.3535 16.2859C97.071 16.7598 96.9206 17.2794 96.9023 17.8445H103.219ZM113.637 26.7585H109.59V11.9109H113.445V14.5085H113.609C113.956 13.6335 114.516 12.95 115.291 12.4578C116.066 11.9656 116.991 11.7195 118.066 11.7195C119.096 11.7195 119.999 11.9428 120.773 12.3894C121.548 12.836 122.145 13.4832 122.564 14.3308C122.984 15.1694 123.189 16.1583 123.18 17.2976V26.7585H119.16V18.0085C119.16 17.0971 118.923 16.3816 118.449 15.8621C117.975 15.3425 117.319 15.0828 116.48 15.0828C115.615 15.0828 114.922 15.3562 114.402 15.9031C113.892 16.45 113.637 17.2065 113.637 18.1726V26.7585ZM134.145 14.946H131.355V22.1921C131.355 22.739 131.474 23.1218 131.711 23.3406C131.948 23.5593 132.294 23.6778 132.75 23.696C133.333 23.696 133.871 23.6687 134.363 23.614V26.8132C133.88 26.9044 133.16 26.95 132.203 26.95C130.681 26.95 129.482 26.599 128.607 25.8972C127.732 25.1954 127.299 24.1518 127.309 22.7664V14.946H125.258V11.9109H127.309V8.3562H131.355V11.9109H134.145V14.946ZM139.066 32.3367C138.219 32.3367 137.535 32.3093 137.016 32.2546V29.1101C137.708 29.1466 138.255 29.1648 138.656 29.1648C138.975 29.1648 139.24 29.1375 139.449 29.0828C139.668 29.0281 139.873 28.9005 140.064 28.7C140.265 28.4994 140.443 28.1986 140.598 27.7976L140.844 27.1687L135.512 11.9109H139.75L142.867 22.8484H143.031L146.176 11.9109H150.469L144.672 28.3992C144.225 29.6661 143.555 30.6368 142.662 31.3113C141.769 31.9949 140.57 32.3367 139.066 32.3367Z"
                fill="#0D0B33"
              />
            </svg>
          </Link>
        </div>
        <div className="flex flex-wrap gap-[16px] p-[16px]">
          <Link
            href="/workspaces/new"
            className="group flex h-[200px] w-[270px] flex-col items-center justify-center gap-[16px] rounded-[20px] border-[1.5px] border-dashed border-gray-lighter hover:border-solid hover:border-blue-normal"
          >
            <div className="flex items-center justify-center rounded-[50%] bg-blue-lighter p-[12px] group-hover:bg-blue-light">
              <div className="flex items-center justify-center text-gray-light group-hover:text-blue-normal">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="20"
                  height="21"
                  viewBox="0 0 20 21"
                  fill="none"
                >
                  <path
                    d="M7 10.0172H13M10 7.01721V13.0172M1 10.0172C1 11.1991 1.23279 12.3694 1.68508 13.4614C2.13738 14.5533 2.80031 15.5454 3.63604 16.3812C4.47177 17.2169 5.46392 17.8798 6.55585 18.3321C7.64778 18.7844 8.8181 19.0172 10 19.0172C11.1819 19.0172 12.3522 18.7844 13.4442 18.3321C14.5361 17.8798 15.5282 17.2169 16.364 16.3812C17.1997 15.5454 17.8626 14.5533 18.3149 13.4614C18.7672 12.3694 19 11.1991 19 10.0172C19 8.83532 18.7672 7.66499 18.3149 6.57306C17.8626 5.48113 17.1997 4.48898 16.364 3.65325C15.5282 2.81752 14.5361 2.15459 13.4442 1.7023C12.3522 1.25 11.1819 1.01721 10 1.01721C8.8181 1.01721 7.64778 1.25 6.55585 1.7023C5.46392 2.15459 4.47177 2.81752 3.63604 3.65325C2.80031 4.48898 2.13738 5.48113 1.68508 6.57306C1.23279 7.66499 1 8.83532 1 10.0172Z"
                    stroke="currentColor"
                    strokeWidth="2"
                    strokeLinecap="round"
                    strokeLinejoin="round"
                  />
                </svg>
              </div>
            </div>
            <div className="text-lg text-gray-light group-hover:text-black-light">
              새로운 워크스페이스 만들기
            </div>
          </Link>
          {workspaces.map((workspace) => (
            <Link
              key={workspace.id}
              href={`/workspaces/${workspace.id}/help-desk/user-chats`}
              className="flex h-[200px] w-[270px] flex-col gap-[16px] rounded-[20px] border border-gray-lightest p-[20px] hover:border-blue-normal hover:shadow-card"
            >
              <div className="flex gap-[16px]">
                <div className="relative flex h-[66px] w-[66px] shrink-0 items-center justify-center overflow-hidden rounded-[8px]">
                  <Image
                    src={workspace.avatarUrl}
                    alt="workspace avatar"
                    fill
                  />
                </div>
                <div className="flex max-w-[calc(100%-66px)] flex-col gap-[12px]">
                  <div className="truncate break-all text-lg">
                    {workspace.name}
                  </div>
                  <div className="flex flex-wrap items-center">
                    {(() => {
                      const cutline = 4;
                      const members = workspace.members;
                      const slicedMembers = members.slice(0, cutline);

                      return (
                        <>
                          {slicedMembers.map((member) => (
                            <div
                              key={member.id}
                              className="workspace-card relative flex h-[24px] w-[24px] items-center justify-center overflow-hidden rounded-[50%]"
                            >
                              <Image
                                src={member.avatarUrl}
                                alt="member avater"
                                fill
                              />
                            </div>
                          ))}
                          {members.length > cutline && (
                            <div className="workspace-card relative flex h-[24px] w-[24px] items-center justify-center overflow-hidden rounded-[50%] bg-blue-normal text-sm text-white-normal">
                              {`+${members.length - cutline}`}
                            </div>
                          )}
                        </>
                      );
                    })()}
                  </div>
                </div>
              </div>
              <div className="text-md text-gray-light">
                {`${workspace.members.length}명이 워크스페이스에 합류했습니다.`}
              </div>
            </Link>
          ))}
        </div>
      </div>
    </div>
  );
}
